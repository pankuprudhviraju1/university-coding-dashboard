import React, { useState, useEffect } from 'react';

// The main App component for the dashboard
export default function App() {
  // Use state to manage the list of student profiles
  const [students, setStudents] = useState([]);
  const [newStudent, setNewStudent] = useState({
    name: '',
    codechef: '',
    codeforces: '',
    leetcode: ''
  });

  // useEffect hook to simulate fetching data
  // In a real application, you would replace this with a fetch to your own backend
  useEffect(() => {
    // --- IMPORTANT: MOCK DATA FOR DEMONSTRATION ---
    // This is where you would call your backend API to get real data.
    // Example: fetch('/api/get-student-data').then(response => response.json()).then(data => setStudents(data));
    const mockData = [
      {
        id: '1',
        name: 'Alex Johnson',
        codeforces: { handle: 'alex_cf', rating: 1650, solved: 1200 },
        codechef: { handle: 'alex_cc', rating: 1800, solved: 950 },
        leetcode: { handle: 'alex_lc', solved: 750, ranking: 5000 }
      },
      {
        id: '2',
        name: 'Maria Garcia',
        codeforces: { handle: 'maria_cf', rating: 2100, solved: 1800 },
        codechef: { handle: 'maria_cc', rating: 2050, solved: 1500 },
        leetcode: { handle: 'maria_lc', solved: 1020, ranking: 1500 }
      },
      {
        id: '3',
        name: 'Ethan Hunt',
        codeforces: { handle: 'ethan_cf', rating: 1100, solved: 500 },
        codechef: { handle: 'ethan_cc', rating: 1350, solved: 400 },
        leetcode: { handle: 'ethan_lc', solved: 300, ranking: 25000 }
      },
    ];
    setStudents(mockData);
  }, []); // Empty dependency array means this runs once on component mount

  // Handle form input changes
  const handleInputChange = (e) => {
    const { name, value } = e.target;
    setNewStudent(prev => ({ ...prev, [name]: value }));
  };

  // Handle form submission to add a new student (mock functionality)
  const handleAddStudent = (e) => {
    e.preventDefault();
    if (newStudent.name && (newStudent.codechef || newStudent.codeforces || newStudent.leetcode)) {
      // In a real app, you would send this to your backend
      // and the backend would then add the student and re-fetch the list.
      const newId = (students.length + 1).toString();
      const updatedStudents = [
        ...students,
        {
          id: newId,
          name: newStudent.name,
          codeforces: newStudent.codeforces ? { handle: newStudent.codeforces, rating: 'N/A', solved: 'N/A' } : null,
          codechef: newStudent.codechef ? { handle: newStudent.codechef, rating: 'N/A', solved: 'N/A' } : null,
          leetcode: newStudent.leetcode ? { handle: newStudent.leetcode, solved: 'N/A', ranking: 'N/A' } : null,
        }
      ];
      setStudents(updatedStudents);
      setNewStudent({ name: '', codechef: '', codeforces: '', leetcode: '' });
    }
  };

  // Helper function to render a profile link if a handle exists
  const renderProfileLink = (platform, handle) => {
    if (!handle || handle === 'N/A') {
      return 'N/A';
    }
    let url;
    if (platform === 'CodeForces') {
      url = `https://codeforces.com/profile/${handle}`;
    } else if (platform === 'CodeChef') {
      url = `https://www.codechef.com/users/${handle}`;
    } else if (platform === 'LeetCode') {
      url = `https://leetcode.com/${handle}`;
    }
    return (
      <a href={url} target="_blank" rel="noopener noreferrer" className="text-blue-500 hover:text-blue-700 hover:underline transition duration-300">
        {handle}
      </a>
    );
  };

  return (
    <div className="min-h-screen bg-gray-100 p-8 font-inter">
      <div className="container mx-auto max-w-6xl">
        <header className="text-center mb-10">
          <h1 className="text-4xl sm:text-5xl md:text-6xl font-extrabold text-gray-900 mb-2">
            University <span className="text-indigo-600">Coding Hub</span>
          </h1>
          <p className="text-lg text-gray-600">
            Track and rank your university's top competitive programmers.
          </p>
        </header>

        {/* Form to add a new student profile */}
        <div className="bg-white p-6 md:p-8 rounded-2xl shadow-lg mb-10">
          <h2 className="text-2xl font-semibold text-gray-800 mb-4">Add a New Student</h2>
          <form onSubmit={handleAddStudent} className="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-4">
            <input
              type="text"
              name="name"
              placeholder="Full Name"
              value={newStudent.name}
              onChange={handleInputChange}
              className="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-300"
              required
            />
            <input
              type="text"
              name="leetcode"
              placeholder="LeetCode Username"
              value={newStudent.leetcode}
              onChange={handleInputChange}
              className="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-300"
            />
            <input
              type="text"
              name="codeforces"
              placeholder="Codeforces Handle"
              value={newStudent.codeforces}
              onChange={handleInputChange}
              className="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-300"
            />
            <input
              type="text"
              name="codechef"
              placeholder="CodeChef Username"
              value={newStudent.codechef}
              onChange={handleInputChange}
              className="p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-indigo-500 transition duration-300"
            />
            <button
              type="submit"
              className="col-span-1 sm:col-span-2 md:col-span-4 p-3 bg-indigo-600 text-white font-bold rounded-lg hover:bg-indigo-700 transition duration-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2"
            >
              Add Student
            </button>
          </form>
        </div>

        {/* Dashboard Table */}
        <div className="bg-white p-6 md:p-8 rounded-2xl shadow-lg overflow-x-auto">
          <h2 className="text-2xl font-semibold text-gray-800 mb-4">Student Leaderboard</h2>
          <table className="min-w-full divide-y divide-gray-200">
            <thead className="bg-gray-50">
              <tr>
                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Rank
                </th>
                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Name
                </th>
                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  LeetCode
                </th>
                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  Codeforces
                </th>
                <th scope="col" className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                  CodeChef
                </th>
              </tr>
            </thead>
            <tbody className="bg-white divide-y divide-gray-200">
              {students.length > 0 ? (
                // Sort students by a combined metric for a simple rank
                students.sort((a, b) => (b.leetcode.solved || 0) - (a.leetcode.solved || 0)).map((student, index) => (
                  <tr key={student.id} className="hover:bg-gray-50 transition duration-150">
                    <td className="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900">
                      {index + 1}
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                      {student.name}
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                      <div className="flex flex-col">
                        <span>Solved: {student.leetcode.solved}</span>
                        <span>Rank: {student.leetcode.ranking}</span>
                      </div>
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                      <div className="flex flex-col">
                        <span>Rating: {student.codeforces.rating}</span>
                        <span>Solved: {student.codeforces.solved}</span>
                      </div>
                    </td>
                    <td className="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                      <div className="flex flex-col">
                        <span>Rating: {student.codechef.rating}</span>
                        <span>Solved: {student.codechef.solved}</span>
                      </div>
                    </td>
                  </tr>
                ))
              ) : (
                <tr>
                  <td colSpan="5" className="px-6 py-4 text-center text-sm text-gray-500">
                    No students added yet.
                  </td>
                </tr>
              )}
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
}
